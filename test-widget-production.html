<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProofLayer Widget Production Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f9fafb;
        }
        h1 { color: #111827; }
        .widget-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            margin: 20px 0;
        }
        .debug {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .debug .error { color: #ff4444; }
        .debug .success { color: #00ff00; }
        .debug .info { color: #44aaff; }
    </style>
</head>
<body>
    <h1>ProofLayer Widget - Production Test</h1>
    <p>Workspace ID: f5f8e5be-c0a0-411f-b6e1-02f7ac2b8f9f</p>

    <div class="debug" id="debug-output">
        <div>Initializing debug console...</div>
    </div>

    <div class="widget-container">
        <h2>Widget Test</h2>
        <div id="prooflayer-widget"></div>
        <script src="https://prooflayer.app/widget.js?v=2" data-workspace="f5f8e5be-c0a0-411f-b6e1-02f7ac2b8f9f" data-layout="grid" data-theme="light"></script>
    </div>

    <script>
        const debugOutput = document.getElementById('debug-output');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugOutput.appendChild(div);
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }

        // Intercept console
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            originalLog.apply(console, args);
            log('LOG: ' + args.join(' '), 'info');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            log('ERROR: ' + args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            log('WARN: ' + args.join(' '), 'info');
        };

        // Monitor fetch requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            log(`Fetching: ${url}`, 'info');

            return originalFetch.apply(this, args)
                .then(response => {
                    log(`Response ${response.status}: ${url}`, response.ok ? 'success' : 'error');
                    return response;
                })
                .catch(error => {
                    log(`Fetch error: ${error.message}`, 'error');
                    throw error;
                });
        };

        // Test API directly
        setTimeout(() => {
            log('--- Testing API directly ---', 'info');
            const apiUrl = 'https://www.prooflayer.app/api/widget/f5f8e5be-c0a0-411f-b6e1-02f7ac2b8f9f';
            log(`API URL: ${apiUrl}`, 'info');

            fetch(apiUrl)
                .then(res => res.json())
                .then(data => {
                    log(`API Response: ${JSON.stringify(data).substring(0, 200)}...`, 'success');
                    log(`Testimonials count: ${data.testimonials?.length || 0}`, 'success');
                })
                .catch(err => {
                    log(`API Error: ${err.message}`, 'error');
                });
        }, 1000);

        // Check widget container after load
        setTimeout(() => {
            const container = document.getElementById('prooflayer-widget');
            if (container) {
                log(`Widget container HTML: ${container.innerHTML.substring(0, 200)}`, 'info');
                if (container.innerHTML.includes('Failed to load')) {
                    log('WIDGET FAILED TO LOAD!', 'error');
                } else if (container.innerHTML.includes('No testimonials')) {
                    log('Widget loaded but no testimonials found', 'info');
                } else if (container.innerHTML.includes('pl-card')) {
                    log('SUCCESS! Testimonials loaded!', 'success');
                }
            }
        }, 3000);

        log('Debug console ready', 'success');
    </script>
</body>
</html>
